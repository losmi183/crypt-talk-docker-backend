import{u as te,a as le,b as ae,c as ne,d as ie,e as ue,f as L,g as re,Q as j}from"./QInput-c1ZgeY1b.js";import{Q as se}from"./QChip-BN1CDVTl.js";import{g as J,r as V,a as f,z as oe,B as G,t as de,h as w,c as ce,a5 as me,y as fe,w as ve,J as pe,M as ge,N as Q,a2 as be,V as U,R as g,T as W,S as K}from"./index-CgK1ss-b.js";import{h as ye}from"./format-CJebrXOQ.js";import{Q as X}from"./QForm-CXM5rvQk.js";import{Q as Y}from"./QCard-B9U7_ZXz.js";import{Q as he}from"./QPage-CMn3O1sP.js";import{u as Fe}from"./auth-oFsSJgPH.js";import{M as R}from"./MyNotify-BlWj1eTP.js";import"./use-dark-zJL703uH.js";function _(e,d,F,b){const r=[];return e.forEach(o=>{b(o)===!0?r.push(o):d.push({failedPropValidation:F,file:o})}),r}function O(e){e?.dataTransfer&&(e.dataTransfer.dropEffect="copy"),G(e)}const xe={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Ve=["rejected"];function Se({editable:e,dnd:d,getFileInput:F,addFilesToQueue:b}){const{props:r,emit:o,proxy:v}=J(),x=V(null),C=f(()=>r.accept!==void 0?r.accept.split(",").map(t=>(t=t.trim(),t==="*"?"*/":(t.endsWith("/*")&&(t=t.slice(0,t.length-1)),t.toUpperCase()))):null),P=f(()=>parseInt(r.maxFiles,10)),z=f(()=>parseInt(r.maxTotalSize,10));function N(t){if(e.value)if(t!==Object(t)&&(t={target:null}),t.target?.matches('input[type="file"]')===!0)t.clientX===0&&t.clientY===0&&oe(t);else{const y=F();y!==t.target&&y?.click(t)}}function A(t){e.value&&t&&b(null,t)}function n(t,y,k,q){let i=Array.from(y||t.target.files);const p=[],S=()=>{p.length!==0&&o("rejected",p)};if(r.accept!==void 0&&C.value.indexOf("*/")===-1&&(i=_(i,p,"accept",u=>C.value.some(c=>u.type.toUpperCase().startsWith(c)||u.name.toUpperCase().endsWith(c))),i.length===0))return S();if(r.maxFileSize!==void 0){const u=parseInt(r.maxFileSize,10);if(i=_(i,p,"max-file-size",c=>c.size<=u),i.length===0)return S()}if(r.multiple!==!0&&i.length!==0&&(i=[i[0]]),i.forEach(u=>{u.__key=u.webkitRelativePath+u.lastModified+u.name+u.size}),q===!0){const u=k.map(c=>c.__key);i=_(i,p,"duplicate",c=>u.includes(c.__key)===!1)}if(i.length===0)return S();if(r.maxTotalSize!==void 0){let u=q===!0?k.reduce((c,B)=>c+B.size,0):0;if(i=_(i,p,"max-total-size",c=>(u+=c.size,u<=z.value)),i.length===0)return S()}if(typeof r.filter=="function"){const u=r.filter(i);i=_(i,p,"filter",c=>u.includes(c))}if(r.maxFiles!==void 0){let u=q===!0?k.length:0;if(i=_(i,p,"max-files",()=>(u++,u<=P.value)),i.length===0)return S()}if(S(),i.length!==0)return i}function s(t){O(t),d.value!==!0&&(d.value=!0)}function l(t){G(t),(t.relatedTarget!==null||de.is.safari!==!0?t.relatedTarget!==x.value:document.elementsFromPoint(t.clientX,t.clientY).includes(x.value)===!1)===!0&&(d.value=!1)}function D(t){O(t);const y=t.dataTransfer.files;y.length!==0&&b(null,y),d.value=!1}function T(t){if(d.value===!0)return w("div",{ref:x,class:`q-${t}__dnd absolute-full`,onDragenter:O,onDragover:O,onDragleave:l,onDrop:D})}return Object.assign(v,{pickFiles:N,addFiles:A}),{pickFiles:N,addFiles:A,onDragover:s,onDragleave:l,processFiles:n,getDndNode:T,maxFilesNumber:P,maxTotalSizeNumber:z}}const we=ce({name:"QFile",inheritAttrs:!1,props:{...ae,...le,...xe,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...te,...Ve],setup(e,{slots:d,emit:F,attrs:b}){const{proxy:r}=J(),o=ne(),v=V(null),x=V(!1),C=ie(e),{pickFiles:P,onDragover:z,onDragleave:N,processFiles:A,getDndNode:n}=Se({editable:o.editable,dnd:x,getFileInput:M,addFilesToQueue:$}),s=ue(e),l=f(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),D=f(()=>L(l.value)),T=f(()=>l.value.map(a=>a.name).join(", ")),t=f(()=>ye(l.value.reduce((a,m)=>a+m.size,0))),y=f(()=>({totalSize:t.value,filesNumber:l.value.length,maxFiles:e.maxFiles})),k=f(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:C.value,...b,id:o.targetUid.value,disabled:o.editable.value!==!0})),q=f(()=>"q-file q-field--auto-height"+(x.value===!0?" q-file--dnd":"")),i=f(()=>e.multiple===!0&&e.append===!0);function p(a){const m=l.value.slice();m.splice(a,1),u(m)}function S(a){const m=l.value.indexOf(a);m!==-1&&p(m)}function u(a){F("update:modelValue",e.multiple===!0?a:a[0])}function c(a){a.keyCode===13&&fe(a)}function B(a){(a.keyCode===13||a.keyCode===32)&&P(a)}function M(){return v.value}function $(a,m){const h=A(a,m,l.value,i.value),E=M();E!=null&&(E.value=""),h!==void 0&&((e.multiple===!0?e.modelValue&&h.every(ee=>l.value.includes(ee)):e.modelValue===h[0])||u(i.value===!0?l.value.concat(h):h))}function I(){return[w("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function H(){if(d.file!==void 0)return l.value.length===0?I():l.value.map((m,h)=>d.file({index:h,file:m,ref:this}));if(d.selected!==void 0)return l.value.length===0?I():d.selected({files:l.value,ref:this});if(e.useChips===!0)return l.value.length===0?I():l.value.map((m,h)=>w(se,{key:"file-"+h,removable:o.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{p(h)}},()=>w("span",{class:"ellipsis",textContent:m.name})));const a=e.displayValue!==void 0?e.displayValue:T.value;return a.length!==0?[w("div",{class:e.inputClass,style:e.inputStyle,textContent:a})]:I()}function Z(){const a={ref:v,...k.value,...s.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:$};return e.multiple===!0&&(a.multiple=!0),w("input",a)}return Object.assign(o,{fieldClass:q,emitValue:u,hasValue:D,inputRef:v,innerValue:l,floatingLabel:f(()=>D.value===!0||L(e.displayValue)),computedCounter:f(()=>{if(e.counterLabel!==void 0)return e.counterLabel(y.value);const a=e.maxFiles;return`${l.value.length}${a!==void 0?" / "+a:""} (${t.value})`}),getControlChild:()=>n("file"),getControl:()=>{const a={ref:o.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return o.editable.value===!0&&Object.assign(a,{onDragover:z,onDragleave:N,onKeydown:c,onKeyup:B}),w("div",a,[Z()].concat(H()))}}),Object.assign(r,{removeAtIndex:p,removeFile:S,getNativeElement:()=>v.value}),me(r,"nativeEl",()=>v.value),re(o)}}),Ce={class:"row q-col-gutter-xl full-width justify-center"},Pe={class:"col-12 col-md-5"},ze={class:"col-12 col-md-5"},Re={__name:"ProfilePage",setup(e){const d=Fe(),F=V(null),b=V(null),r=V(null),o=V(null),v=V(null),x=V(null),C=n=>n?.trim().length>=2||"Name must have at least 2 characters",P=n=>n?.trim().length>=4||"Password must have at least 4 characters",z=n=>n===v.value||"Passwords do not match";ve(()=>d.user,n=>{n&&(F.value=n?.email||"",b.value=n?.name||"",r.value=n?.about||"")},{immediate:!0});async function N(){try{const n=await d.profileUpdate(b.value,r.value,o.value);R.success(n.data.message),d.refresh()}catch(n){console.error("Profile update error:",n),n.response?.data?.message,R.error(n)}}async function A(){try{const n=await d.passwordUpdate(v.value);R.success(n.data.message)}catch(n){console.error("Profile update error:",n),n.response?.data?.message,R.error(n)}}return(n,s)=>(ge(),pe(he,{class:be(["flex flex-center",n.$q.dark.isActive?"bg-dark":"bg-grey-2"])},{default:Q(()=>[U("div",Ce,[U("div",Pe,[g(Y,{class:"q-pa-lg"},{default:Q(()=>[g(X,{onSubmit:W(N,["prevent"]),class:"column q-gutter-md"},{default:Q(()=>[s[6]||(s[6]=U("div",{class:"text-h5 text-center text-primary"},"Profile",-1)),g(j,{disable:"",filled:"",modelValue:F.value,"onUpdate:modelValue":s[0]||(s[0]=l=>F.value=l),label:"Email"},null,8,["modelValue"]),g(j,{filled:"",modelValue:b.value,"onUpdate:modelValue":s[1]||(s[1]=l=>b.value=l),label:"Name",rules:[C]},null,8,["modelValue","rules"]),g(j,{filled:"",modelValue:r.value,"onUpdate:modelValue":s[2]||(s[2]=l=>r.value=l),label:"About"},null,8,["modelValue"]),g(we,{filled:"",modelValue:o.value,"onUpdate:modelValue":s[3]||(s[3]=l=>o.value=l),label:"Avatar",accept:"image/*"},null,8,["modelValue"]),g(K,{label:"Update profile",type:"submit",color:"primary",unelevated:"",class:"q-mt-md"})]),_:1})]),_:1})]),U("div",ze,[g(Y,{class:"q-pa-lg"},{default:Q(()=>[g(X,{onSubmit:W(A,["prevent"]),class:"column q-gutter-md"},{default:Q(()=>[s[7]||(s[7]=U("div",{class:"text-h5 text-center text-primary"},"Password",-1)),g(j,{filled:"",modelValue:v.value,"onUpdate:modelValue":s[4]||(s[4]=l=>v.value=l),label:"Password",type:"password",rules:[P]},null,8,["modelValue","rules"]),g(j,{filled:"",modelValue:x.value,"onUpdate:modelValue":s[5]||(s[5]=l=>x.value=l),label:"Repeat password",type:"password",rules:[z]},null,8,["modelValue","rules"]),g(K,{label:"Update password",type:"submit",color:"primary",unelevated:"",class:"q-mt-md"})]),_:1})]),_:1})])])]),_:1},8,["class"]))}};export{Re as default};
